from Crypto.Cipher import AES
from hashlib import sha256

# Bước 1: Đọc hex string từ file
with open("encDLL.txt", "r") as f:
    hex_data = f.read().strip()  # loại bỏ khoảng trắng, xuống dòng

# Bước 2: Chuyển chuỗi hex thành bytes
ciphertext = bytes.fromhex(hex_data)

# Bước 3: Kiểm tra độ dài
if len(ciphertext) % 16 != 0:
    print(f"[!] Lỗi: Dữ liệu không chia hết cho 16 byte ({len(ciphertext)} bytes)")
    exit(1)

# Bước 4: Tạo key AES-256 từ SHA256("hackingisnotacrime")
key = sha256(b"hackingisnotacrime").digest()

# Bước 5: Giải mã bằng AES-256 ECB
cipher = AES.new(key, AES.MODE_ECB)
plaintext = cipher.decrypt(ciphertext)

# Bước 6: Ghi ra file DLL
with open("libgen.dll", "wb") as f:
    f.write(plaintext)

print("[+] Giải mã thành công! File đã lưu: libgen.dll")
